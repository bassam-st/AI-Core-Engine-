<!-- templates/sports_today.html -->
<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>مباريات اليوم</title>
<style>
 body{font-family:system-ui,Segoe UI,Roboto,Arial;background:#0f172a;color:#e2e8f0;margin:0;padding:16px}
 .wrap{max-width:900px;margin:auto}
 .row{border:1px solid #223;border-radius:14px;padding:12px;margin:10px 0;background:#0b1220}
 .title{font-weight:700;font-size:16px}
 .sub{opacity:.85;font-size:13px}
 .btn{padding:8px 12px;border:0;border-radius:10px;background:#10b981;color:#041016;font-weight:700}
 .badge{display:inline-block;padding:4px 8px;border-radius:9999px;background:#1f2937;color:#e2e8f0;margin:2px}
 input,button{font-family:inherit}
 .ctrl{display:flex;gap:8px;align-items:center;margin-bottom:10px}
</style>
</head>
<body>
<div class="wrap">
  <h2>🏟️ مباريات اليوم</h2>
  <div class="ctrl">
    <input id="league" placeholder="فلترة الدوري (اختياري)" style="flex:1;padding:8px;border-radius:10px;border:1px solid #223;background:#0b1220;color:#e2e8f0"/>
    <label style="display:flex;gap:6px;align-items:center"><input type="checkbox" id="liveOnly"/> لايف الآن</label>
    <button class="btn" onclick="load()">تحديث</button>
  </div>
  <div id="sources"></div>
  <div id="list"></div>
</div>
<script>
let allMatches=[];
async function load(){
  const lg=document.getElementById('league').value||"";
  const url = lg ? `/api/sports/today?league=${encodeURIComponent(lg)}` : `/api/sports/today`;
  const r=await fetch(url);
  const data=await r.json();
  allMatches = data.matches||[];
  const srcDiv=document.getElementById('sources');
  srcDiv.innerHTML = "المصادر: " + (data.sources||[]).map(s=>`<a class="badge" href="${s.url}" target="_blank">${s.name}</a>`).join(" ");
  render();
}
function render(){
  const liveOnly=document.getElementById('liveOnly').checked;
  const list=document.getElementById('list'); list.innerHTML="";
  const items = liveOnly ? allMatches.filter(isLive) : allMatches;
  if(!items.length){ list.innerHTML=`<div class="row">لا توجد مباريات الآن.</div>`; return; }
  for(const m of items){
    const div=document.createElement('div'); div.className="row";
    const liveTag = isLive(m) ? " — مباشر الآن" : "";
    div.innerHTML = `
      <div class="title">${m.home} × ${m.away}</div>
      <div class="sub">${m.league||""} • ${m.time||""}${liveTag}</div>
      <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
        <a class="btn" href="/ui/sports_player?url=${encodeURIComponent('/api/xtream/play/22')}">تشغيل مثال</a>
        <a class="badge" href="${(m.source&&m.source.url)||'#'}" target="_blank">المصدر</a>
      </div>
    `;
    list.appendChild(div);
  }
}
function isLive(m){
  const t=(m.time||"").toLowerCase();
  return ["live","مباشر","حي","قيد اللعب","قيد الانتهاء"].some(x=>t.includes(x));
}
load();
document.getElementById('liveOnly').addEventListener('change', render);
</script>
</body>
</html>
