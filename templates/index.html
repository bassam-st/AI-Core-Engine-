<!doctype html>
<meta charset="utf-8" />
<title>Al Core Engine â€” Free Brain</title>
<link rel="stylesheet" href="/static/style.css" />
<div class="wrap">
  <h1>Ø§Ù„Ù†ÙˆØ§Ø© Ø§Ù„Ø°ÙƒÙŠØ© â€” Ù…Ø¬Ø§Ù†ÙŠØ© ÙˆØ¨Ø¯ÙˆÙ† Ù…ÙØ§ØªÙŠØ­</h1>
  <div id="chat"></div>
  <form id="f">
    <input id="msg" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." />
    <button>Ø¥Ø±Ø³Ø§Ù„</button>
  </form>

  <div class="row">
    <button id="learnBtn">ØªØ¹Ù„Ù‘Ù…ÙŠ Ø§Ù„Ø¢Ù† (Autolearn)</button>
    <input id="fact" placeholder="Ø£Ø¶Ù Ù…Ø¹Ù„ÙˆÙ…Ø© ÙŠØ¯ÙˆÙŠØ©..." />
    <button id="saveFact">Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø©</button>
  </div>

  <div class="sources" id="sources"></div>
</div>
<script>
const chat = document.getElementById('chat');
const f = document.getElementById('f');
const msg = document.getElementById('msg');
const sources = document.getElementById('sources');
const learnBtn = document.getElementById('learnBtn');
const fact = document.getElementById('fact');
const saveFact = document.getElementById('saveFact');

f.addEventListener('submit', async (e) => {
  e.preventDefault();
  const q = msg.value.trim();
  if(!q) return;
  chat.innerHTML += `<div class="you">${q}</div>`;
  msg.value = "";
  const r = await fetch('/api/chat', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({message: q})
  });
  const j = await r.json();
  chat.innerHTML += `<div class="bot">${(j.reply||'').replace(/\n/g,'<br>')}</div>`;
  sources.innerHTML = (j.sources||[]).map(s=>`<a target="_blank" href="${s.url}">ğŸ”— ${s.title}</a>`).join(' ');
});

learnBtn.addEventListener('click', async () => {
  learnBtn.disabled = true;
  learnBtn.textContent = "ØªØ¹Ù…Ù„...";
  try{
    const r = await fetch('/api/autolearn/run', {method:'POST'});
    const j = await r.json();
    chat.innerHTML += `<div class="bot">ØªÙ… Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ø°Ø§ØªÙŠ: Ø£Ø¶ÙØª ${j.added||0} Ø¬Ù…Ù„Ø© Ù…Ø¹Ø±ÙØ©.</div>`;
  } finally {
    learnBtn.disabled = false;
    learnBtn.textContent = "ØªØ¹Ù„Ù‘Ù…ÙŠ Ø§Ù„Ø¢Ù† (Autolearn)";
  }
});

saveFact.addEventListener('click', async () => {
  const t = fact.value.trim();
  if(!t) return;
  const r = await fetch('/api/learn', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({text: t, source: "manual"})
  });
  fact.value = "";
  chat.innerHTML += `<div class="bot">ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© âœ…</div>`;
});
</script>
